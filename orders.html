<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Orders</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  nav { background: #333; padding: 10px; }
  nav a { color: white; margin-right: 15px; text-decoration: none; }
  nav a:hover { text-decoration: underline; }
  form { margin-bottom: 20px; }
  label { display: block; margin-top: 10px; }
  input, select { padding: 5px; width: 100%; max-width: 300px; }
  button { margin-top: 15px; padding: 8px 12px; }
  #searchBar { margin-top: 10px; padding: 6px; width: 300px; }
  .order-entry { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
  .order-buttons button { margin-right: 10px; }
  .order-header { font-weight: bold; margin-bottom: 5px; }
  .inline { display: inline-block; margin-right: 10px; }
</style>
</head>
<body>

<nav>
  <a href="product.html">Products</a>
  <a href="employee.html">Employees</a>
  <a href="customers.html">Customers</a>
  <a href="orders.html">Orders</a>
</nav>

<h1>Orders</h1>

<form id="orderForm">
  <label for="orderDate">Order Date</label>
  <input type="date" id="orderDate" required />

  <label for="itemStatus">Item Status</label>
  <select id="itemStatus" required>
    <option value="">-- Select Status --</option>
    <option value="pending">Pending</option>
    <option value="shipped">Shipped</option>
    <option value="delivered">Delivered</option>
    <option value="cancelled">Cancelled</option>
  </select>

<form id="orderForm" onsubmit="event.preventDefault(); addOrder();">
  <label for="orderId">Order ID:</label><br>
  <input type="text" id="orderId" required><br>

  <label for="orderDate">Order Date:</label><br>
  <input type="date" id="orderDate" required><br>

  <label for="itemId">Item ID:</label><br>
  <input type="text" id="itemId" required><br><

  <label for="productName">Product Name:</label><br>
  <input type="text" id="productName" required><br>

  <label for="quantity">Quantity (kg):</label><br>
  <input type="number" id="quantity" required><br>

  <label for="itemStatus">Item Status:</label><br>
  <select id="itemStatus" required>
    <option value="pending">Pending</option>
    <option value="shipped">Shipped</option>
    <option value="delivered">Delivered</option>
    <option value="cancelled">Cancelled</option>
  </select><br>

  <label for="customerName">Customer Name:</label>
  <input type="text" id="customerName" required><br>

  <label for="storageLocation">Storage Location:</label><br>
  <input type="text" id="storageLocation" required><br>

  <label for="destination">Destination:</label><br>
  <input type="text" id="destination" required><br>

  <button type="submit">Add Order</button><br>

  <label for="searchBar">Search All Fields:</label><br>
  <input type="text" id="searchBar" placeholder="Search orders..." oninput="searchOrders()">
</form>

<div id="orderList"></div>

<script>
// Save form inputs in localStorage and restore on load
const form = document.getElementById('orderForm');
const inputs = Array.from(form.elements).filter(el => el.tagName === 'INPUT' || el.tagName === 'SELECT');
inputs.forEach(input => {
  const saved = localStorage.getItem('order_' + input.id);
  if (saved) input.value = saved;
  input.addEventListener('input', () => localStorage.setItem('order_' + input.id, input.value));
});

let orders = JSON.parse(localStorage.getItem('orders')) || [];

function renderOrders(filter = '') {
  const container = document.getElementById('orderList');
  container.innerHTML = '';

  // Filter orders by search string (case-insensitive)
  const filtered = orders.filter(order => {
    return Object.values(order).some(val =>
      String(val).toLowerCase().includes(filter.toLowerCase())
    );
  });

  filtered.forEach((order, index) => {
    const div = document.createElement('div');
    div.className = 'order-entry';

    div.innerHTML = `
      <div class="order-header">Order #${index + 1} - ${order.orderDate} - ${order.itemStatus}</div>
      <div><span class="inline"><strong>Customer:</strong> ${order.customerName}</span>
      <span class="inline"><strong>Item ID:</strong> ${order.itemId}</span>
      <span class="inline"><strong>Quantity:</strong> ${order.quantity}</span></div>
      <div><strong>Invoice:</strong> Payment: ${order.paymentMethod}, Price: $${parseFloat(order.price).toFixed(2)}, Tax: $${parseFloat(order.tax).toFixed(2)}, Shipping: $${parseFloat(order.shippingRate).toFixed(2)}</div>
      <div class="order-buttons">
        <button onclick="viewDetails(${index})">View Detail</button>
        <button onclick="reOrder(${index})">Re-order</button>
        <button onclick="modifyQuantity(${index})">Modify Quantity</button>
        <button onclick="deleteOrder(${index})">Delete</button>
      </div>
      <div id="detail-${index}" style="display:none; margin-top:10px; font-size:0.9em; color:#555;"></div>
    `;

    container.appendChild(div);
  });
}

function clearForm() {
  form.reset();
  inputs.forEach(input => localStorage.removeItem('order_' + input.id));
}

function deleteOrder(index) {
  if (!confirm('Delete this order?')) return;
  orders.splice(index, 1);
  saveOrders();
  renderOrders(document.getElementById('searchBar').value);
}

function saveOrders() {
  localStorage.setItem('orders', JSON.stringify(orders));
}

function viewDetails(index) {
  const detailDiv = document.getElementById(`detail-${index}`);
  if (detailDiv.style.display === 'block') {
    detailDiv.style.display = 'none';
    detailDiv.innerHTML = '';
    return;
  }

  // Example details: receipt, shipping method, history
  const order = orders[index];
  detailDiv.style.display = 'block';
  detailDiv.innerHTML = `
    <div><strong>Receipt:</strong> Order on ${order.orderDate} for ${order.quantity} item(s) at $${parseFloat(order.price).toFixed(2)} each.</div>
    <div><strong>Shipping Method:</strong> Standard Ground</div>
    <div><strong>History:</strong> Status changed to ${order.itemStatus}.</div>
  `;
}

function reOrder(index) {
  const original = orders[index];
  const newOrder = { ...original, orderDate: new Date().toISOString().split('T')[0], itemStatus: 'pending' };
  orders.push(newOrder);
  saveOrders();
  renderOrders(document.getElementById('searchBar').value);
  alert('Re-order placed with today\'s date and status set to pending.');
}

function modifyQuantity(index) {
  const newQty = prompt('Enter new quantity:', orders[index].quantity);
  if (newQty && !isNaN(newQty) && Number(newQty) > 0) {
    orders[index].quantity = Number(newQty);
    saveOrders();
    renderOrders(document.getElementById('searchBar').value);
  } else {
    alert('Invalid quantity.');
  }
}

form.addEventListener('submit', e => {
  e.preventDefault();
  const newOrder = {
    orderDate: form.orderDate.value,
    itemStatus: form.itemStatus.value,
    paymentMethod: form.paymentMethod.value.trim(),
    price: parseFloat(form.price.value).toFixed(2),
    tax: parseFloat(form.tax.value).toFixed(2),
    shippingRate: parseFloat(form.shippingRate.value).toFixed(2),
    quantity: Number(form.quantity.value),
    itemId: form.itemId.value.trim(),
    customerName: form.customerName.value.trim(),
  };
  orders.push(newOrder);
  saveOrders();
  renderOrders(document.getElementById('searchBar').value);
  clearForm();
});

document.getElementById('searchBar').addEventListener('input', e => {
  renderOrders(e.target.value);
});

renderOrders();
</script>

</body>
</html>
